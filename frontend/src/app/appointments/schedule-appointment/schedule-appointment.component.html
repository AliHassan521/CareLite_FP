<app-navbar />
<div class="appointment-container">
  <h2>Schedule Appointment</h2>
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <label>Patient</label>
    <select formControlName="patientId">
      <option value="">Select patient</option>
      @for (patient of patients; track patient.patientId) {
      <option [value]="patient.patientId">{{ patient.fullName }}</option>
      }
    </select>
    <div *ngIf="form.controls.patientId.touched && form.controls.patientId.invalid" class="error">Patient is required.</div>
    <label>Provider</label>
    <select formControlName="providerId">
      <option value="">Select provider</option>
      @for (provider of providers; track provider.userId) {
      <option [value]="provider.userId">{{ provider.fullName }}</option>
      }
    </select>
    <div *ngIf="form.controls.providerId.touched && form.controls.providerId.invalid" class="error">Provider is required.</div>
    <!-- <label>Date</label>
    <input type="date" formControlName="date" />
    <label>Time</label>
    <input type="time" formControlName="time" /> -->
    <input type="date" formControlName="date" />
    <div *ngIf="form.controls.date.touched && form.controls.date.invalid">
      <div *ngIf="form.controls.date.errors?.required" class="error">Date is required.</div>
      <div *ngIf="form.controls.date.errors?.pastDate" class="error">Date cannot be in the past.</div>
    </div>

    <input type="time" formControlName="time" />
    <div *ngIf="form.controls.time.touched && form.controls.time.invalid">
      <div *ngIf="form.controls.time.errors?.required" class="error">Time is required.</div>
      <div *ngIf="form.controls.time.errors?.outsideBusinessHours" class="error">Time must be between {{ businessHours.ClinicStart }} and {{ businessHours.ClinicEnd }}.</div>
      <div *ngIf="form.controls.time.errors?.inBreakTime" class="error">Cannot schedule during break ({{ businessHours.BreakStart }}â€“{{ businessHours.BreakEnd }}).</div>
    </div>

    <label>Duration</label>
    <select formControlName="durationMinutes">
      <option value="">Select duration</option>
      <option [value]="15">15 minutes</option>
      <option [value]="30">30 minutes</option>
      <option [value]="60">60 minutes</option>
    </select>
    <div *ngIf="form.controls.durationMinutes.touched && form.controls.durationMinutes.invalid" class="error">Duration is required.</div>
    <button type="submit" [disabled]="form.invalid || loading">
      @if (loading) { Scheduling... } @else { Schedule }
    </button>
  </form>
</div>
