<div class="finance-report card">
  <h2>Outstanding Balances</h2>
  <form [formGroup]="form" (ngSubmit)="loadBalances()">
    <label for="patientName">Patient Name</label>
    <input id="patientName" type="text" formControlName="patientName" />
    <button class="modern-btn" type="submit" [disabled]="loading">Filter</button>
    <button class="modern-btn" type="button" (click)="exportCsv()">Export CSV</button>
  </form>
  @if (loading) {
    <div>Loading...</div>
  }
  @if (error) {
    <div class="error">{{ error }}</div>
  }
  @if (!loading && balances.length) {
    <table class="report-table">
      <thead>
        <tr>
          <th>Patient</th>
          <th>Bill ID</th>
          <th>Total Amount</th>
          <th>Total Paid</th>
          <th>Outstanding</th>
        </tr>
      </thead>
      <tbody>
        @for (b of balances; track b.BillId) {
          <tr>
            <td>{{ b.FullName }}</td>
            <td>{{ b.BillId }}</td>
            <td>{{ b.TotalAmount | number:'1.2-2' }}</td>
            <td>{{ b.TotalPaid | number:'1.2-2' }}</td>
            <td>{{ b.OutstandingBalance | number:'1.2-2' }}</td>
          </tr>
        }
      </tbody>
    </table>
  }
</div>
